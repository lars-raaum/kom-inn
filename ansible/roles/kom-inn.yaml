---
- hosts:
  - dev
  - pro
  roles:
    - apache.yaml
  tasks:
  - name: Deploy
    git: repo=https://github.com/lars-raaum/kom-inn dest=/services/kom-inn force=True version=0.8.4
  - name: install web api php dependencies
    shell: composer install
    args:
      chdir: /services/kom-inn/web-api/
  - name: install admin api php dependencies
    shell: composer install
    args:
      chdir: /services/kom-inn/admin-api/
  - name: install cron php dependencies
    shell: composer install
    args:
      chdir: /services/kom-inn/crons/
  - name: setup cronjob for looking for stale matches
    cron: name="emails" minute="0" hour="8" user="deploy" job="php /services/kom-inn/crons/stale_matches.php -v > /var/log/kom-inn/stale_matches.log"
  - name: setup cronjob for updating/purging people
    cron: name="emails" minute="0" hour="12" user="deploy" job="php /services/kom-inn/crons/update_people.php -vd > /var/log/kom-inn/update_people.log"
